name: Deployment Status

on:
  deployment_status:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Deployment Success Notification
        if: github.event.deployment_status.state == 'success'
        uses: actions/github-script@v7
        with:
          script: |
            console.log('✅ Successfully deployed to: ${{ github.event.deployment_status.target_url }}');
            
            // 最新のコミットにコメント追加（オプション）
            const commits = await github.rest.repos.listCommits({
              owner: context.repo.owner,
              repo: context.repo.repo,
              per_page: 1
            });
            
            if (commits.data.length > 0) {
              await github.rest.repos.createCommitComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                commit_sha: commits.data[0].sha,
                body: '✅ Deployed successfully to [${{ github.event.deployment_status.target_url }}](${{ github.event.deployment_status.target_url }})'
              });
            }
      
      - name: Deployment Failure Notification
        if: github.event.deployment_status.state == 'failure'
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '❌ Deployment failed',
              body: 'Deployment to GitHub Pages failed. Please check the [deployment logs](${{ github.event.deployment_status.log_url }}).',
              labels: ['bug', 'deployment']
            })
