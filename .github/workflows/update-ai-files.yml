name: Update AI/LLM Info Files

on:
  schedule:
    # æ¯Žé€±æœˆæ›œæ—¥ 00:00 UTC ã«å®Ÿè¡Œ
    - cron: '0 0 * * 1'
  workflow_dispatch:
  push:
    paths:
      - 'README.md'
      - 'index.html'

permissions:
  contents: write
  pull-requests: write

jobs:
  update-ai-files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Update ai.txt and llm.txt
        run: |
          CURRENT_DATE=$(date +%Y-%m-%d)
          VERSION="1.1.0"
          
          # ai.txtã¨llm.txtã®æœ€çµ‚æ›´æ–°æ—¥ã‚’æ›´æ–°
          for file in ai.txt llm.txt; do
            if [ -f "$file" ]; then
              # Last Updatedã®æ—¥ä»˜ã‚’æ›´æ–°
              sed -i "s/Last updated: .*/Last updated: ${CURRENT_DATE}/" "$file"
              sed -i "s/- \*\*Last Updated\*\*: .*/- **Last Updated**: ${CURRENT_DATE}/" "$file"
              
              # ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
              if ! grep -q "Version:" "$file"; then
                # Site Overviewã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«è¿½åŠ 
                sed -i "/## Site Overview/a - **Version**: ${VERSION}" "$file"
              else
                # æ—¢å­˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°
                sed -i "s/- \*\*Version\*\*: .*/- **Version**: ${VERSION}/" "$file"
              fi
              
              echo "Updated $file with date: ${CURRENT_DATE} and version: ${VERSION}"
            fi
          done
          
          # README.mdã‹ã‚‰ä¸»è¦æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ai.txtã«åæ˜ 
          if [ -f "README.md" ]; then
            # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            WORKFLOW_COUNT=$(find .github/workflows -name "*.yml" -o -name "*.yaml" | wc -l)
            
            # ai.txtã®Technical Detailsã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°
            for file in ai.txt llm.txt; do
              if [ -f "$file" ]; then
                # ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ•°ã‚’æ›´æ–°ã¾ãŸã¯è¿½åŠ 
                if grep -q "Automated Workflows:" "$file"; then
                  sed -i "s/- \*\*Automated Workflows\*\*: .*/- **Automated Workflows**: ${WORKFLOW_COUNT} GitHub Actions workflows/" "$file"
                else
                  sed -i "/## Technical Details/a - **Automated Workflows**: ${WORKFLOW_COUNT} GitHub Actions workflows" "$file"
                fi
              fi
            done
          fi
      
      - name: Check for changes
        id: check_changes
        run: |
          if git diff --quiet; then
            echo "has_changes=false" >> $GITHUB_OUTPUT
          else
            echo "has_changes=true" >> $GITHUB_OUTPUT
          fi
      
      - name: Create Pull Request
        if: steps.check_changes.outputs.has_changes == 'true'
        uses: peter-evans/create-pull-request@v8
        with:
          commit-message: 'chore: Update ai.txt and llm.txt metadata'
          title: 'ðŸ¤– Update AI/LLM info files'
          body: |
            ## ðŸ“… Automated AI/LLM Files Update
            
            This PR automatically updates AI-friendly information files with:
            - Current timestamp
            - Version information
            - Metadata extracted from README.md
            - Workflow statistics
            
            ### Changes:
            - Updated ai.txt with latest metadata
            - Updated llm.txt with latest metadata
            - Synced version and date information
            
            This is an automated weekly maintenance task.
          branch: auto-update-ai-files-${{ github.run_number }}
          labels: chore, automated
          delete-branch: true
